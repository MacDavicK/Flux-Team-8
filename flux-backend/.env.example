# ──────────────────────────────────────────────
# App
# ──────────────────────────────────────────────
APP_ENV=development                          # development | production
SECRET_KEY=<random-64-char-hex>             # Used for signing internal tokens
LOG_LEVEL=INFO

# ──────────────────────────────────────────────
# Supabase / PostgreSQL
# ──────────────────────────────────────────────
SUPABASE_URL=https://<project>.supabase.co
SUPABASE_ANON_KEY=<anon-key>
SUPABASE_SERVICE_ROLE_KEY=<service-role-key>
# Direct connection (port 5432) — required for asyncpg + LangGraph checkpointer
# Do NOT use the PgBouncer pooler URL (port 6543) — transaction-mode pooling
# is incompatible with asyncpg prepared statements and LangGraph checkpoint writes.
DATABASE_URL=postgresql+asyncpg://postgres:<password>@db.<project>.supabase.co:5432/postgres

# ──────────────────────────────────────────────
# LLM Providers — All via OpenRouter
# ──────────────────────────────────────────────
# Single API key covers OpenAI, Anthropic, and all other OpenRouter-supported models.
# Get your key at: https://openrouter.ai/keys
OPENROUTER_API_KEY=sk-or-...
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
# Optional: identify your app in OpenRouter's dashboard (used for analytics/rate limiting)
OPENROUTER_APP_NAME=Flux
OPENROUTER_APP_URL=https://yourapp.com

# ──────────────────────────────────────────────
# LangSmith (Agent Tracing)
# ──────────────────────────────────────────────
LANGCHAIN_TRACING_V2=true
LANGCHAIN_ENDPOINT=https://api.smith.langchain.com
LANGCHAIN_API_KEY=ls__...
LANGCHAIN_PROJECT=flux-production             # or flux-development

# ──────────────────────────────────────────────
# Sentry (Error Tracking)
# ──────────────────────────────────────────────
SENTRY_DSN=https://...@sentry.io/...
SENTRY_TRACES_SAMPLE_RATE=0.2               # 20% performance tracing in prod
SENTRY_ENVIRONMENT=production               # or development

# ──────────────────────────────────────────────
# Twilio
# ──────────────────────────────────────────────
TWILIO_ACCOUNT_SID=AC...
TWILIO_AUTH_TOKEN=...
TWILIO_WHATSAPP_FROM=whatsapp:+14155238886  # Sandbox or approved sender
TWILIO_VOICE_FROM=+1...                     # Verified Twilio voice number
TWILIO_VERIFY_SERVICE_SID=VA...             # Twilio Verify service SID
TWILIO_WEBHOOK_BASE_URL=https://api.yourapp.com  # Local dev: set this to https://<your-ngrok-domain>. Production: your deployed API URL.

# ──────────────────────────────────────────────
# ngrok (local development only)
# Sign up at https://ngrok.com, then:
#   1. Copy your auth token from https://dashboard.ngrok.com/get-started/your-authtoken
#   2. Claim a free static domain at https://dashboard.ngrok.com/cloud-edge/domains
#   3. Run: docker compose --profile ngrok up
#   4. Set TWILIO_WEBHOOK_BASE_URL=https://<your-ngrok-domain>
# These values are NOT needed in production.
# ──────────────────────────────────────────────
NGROK_AUTHTOKEN=<your-ngrok-authtoken>
NGROK_DOMAIN=<your-static-subdomain>.ngrok-free.app

# ──────────────────────────────────────────────
# Web Push (VAPID)
# ──────────────────────────────────────────────
VAPID_PRIVATE_KEY=<base64-encoded-private-key>
VAPID_PUBLIC_KEY=<base64-encoded-public-key>
VAPID_CLAIMS_EMAIL=mailto:admin@yourapp.com

# ──────────────────────────────────────────────
# Redis (Rate Limiting + APScheduler at scale)
# ──────────────────────────────────────────────
REDIS_URL=redis://localhost:6379/0

# ──────────────────────────────────────────────
# Notification Defaults (all configurable per user)
# ──────────────────────────────────────────────
REMINDER_LEAD_MINUTES=10
ESCALATION_WINDOW_MINUTES=2
NOTIFICATION_POLL_INTERVAL_SECONDS=60

# ──────────────────────────────────────────────
# Cost Controls
# ──────────────────────────────────────────────
MONTHLY_TOKEN_SOFT_LIMIT=500000             # Per user; warn at this level
MONTHLY_TOKEN_HARD_LIMIT=1000000            # Per user; degrade to cheaper model
MAX_CONVERSATION_MESSAGES=20                # Older messages are summarized
MAX_CONVERSATION_TOKENS=8000               # Trigger summarization above this

# ──────────────────────────────────────────────
# Business Logic
# ──────────────────────────────────────────────
MAX_ACTIVE_GOALS=3
GOAL_SPRINT_WEEKS=6
PATTERN_MISS_THRESHOLD=3                    # Consecutive misses before flagging avoidance
PATTERN_MIN_DATAPOINTS=3                    # Min data points before a pattern is reported
